# Extending Flex - HVS Salesforce Integration

Twilio Flex Plugins allow you to customize the appearance and behavior of [Twilio Flex](https://www.twilio.com/flex). If you want to learn more about the capabilities and how to use the API, check out our [Flex documentation](https://www.twilio.com/docs/flex).

## Setup

Make sure you have [Node.js](https://nodejs.org) as well as [`npm`](https://npmjs.com). We support Node >= 10.12 (and recommend the _even_ versions of Node). Afterwards, install the dependencies by running `npm install`:

```bash
cd 

# If you use npm
npm install
```

Next, please install the [Twilio CLI](https://www.twilio.com/docs/twilio-cli/quickstart) by running:

```bash
brew tap twilio/brew && brew install twilio
```

Finally, install the [Flex Plugin extension](https://github.com/twilio-labs/plugin-flex/tree/v1-beta) for the Twilio CLI:

```bash
twilio plugins:install @twilio-labs/plugin-flex@beta
```

## Development

Run `twilio flex:plugins --help` to see all the commands we currently support. For further details on Flex Plugins refer to our documentation on the [Twilio Docs](https://www.twilio.com/docs/flex/developer/plugins/cli) page.

OR

Follow following steps to deploy your plugin code to your Twilio Account
Step 1: Create a Twilio profile and provide Account SID, AuthToken and Profile name
```bash
    twilio login
```
Step 2: Set your profile as an active profile for code deployment
```bash
    twilio profiles:use <<Enter your profile name created in Step 1>>
```

Step 3: Build your Flex code
```bash
    twilio flex:plugins:build
```

Step 4: Deploy your code
```bash
    twilio flex:plugins:deploy --major --changelog "V1.0" --description "Enter description" --public

    Output:
    twilio flex:plugins:release --plugin flex-hvs@1.0.0 --name "Autogenerated Release 1637363527795" --description "The description of this Flex Plugin Configuration."
```

Step 5: YOu can use step 4 output to publish your Flex plugin.
```bash
    twilio flex:plugins:release --plugin flex-hvs@1.0.0 --name "HVS Release" --description "The description of this Flex Plugin Configuration."
```

Step 6: Go to your Salesforce HVS instance and find out which field are you using to track sales cadence while creating task. For this sample code, I have created a single picklist field on Activity object, label "Call Result" and API Name is "Call_Result__c". Make sure that you have added all the oprtions you are using to branching your sales cadence,

Step 7:Open Salesforce Developer Console and add following APEX code.
```bash
    public class TaskHelper {
    
     public static Task createTask(String phoneNumber, string direction, string channel, string sid) {
        //Fetch information about contact, modify query if needed
        if(phoneNumber == null) {
            return null;
        }
        
        Contact sObjectContact = [
            Select Id, Firstname, OwnerId 
            From Contact
            Where MobilePhone =: phoneNumber OR Phone =: phoneNumber
            Limit 1
        ];
        if(sObjectContact != null){
            Task sObjectTask = new Task();
			sObjectTask.Subject = direction + 'call - on ' + date.today().format();
			sObjectTask.Status = 'Open';
            sObjectTask.ActivityDate = date.today();
			sObjectTask.Priority = 'Normal';
			sObjectTask.WhoId = sObjectContact.ID;
			sObjectTask.OwnerId = sObjectContact.OwnerId;
            sObjectTask.CallObject = sid;
			insert sObjectTask;
            
            return sObjectTask;
        }
        
        return null;
        
    }
    
    public static Task fatchDesposition(String taskId) {
        //Fetch information about contact, modify query if needed
        if(taskId == null) {
            return null;
        }
        Task sObjectTask = [
            Select Id, Call_Result__c  
            From Task
            Where Id =: taskId
            Limit 1
        ];
        
        return sObjectTask;
    }

}
```








